# This Reviewpad YML defines groups of people, rules and workflows
# to be used in the entire organization

labels:
  do-not-merge:
    description: Pull request cannot be merged
    color: "#e63946"

dictionaries:
  - name: teams
    spec:
      security: '["reviewpad-bot", "engineeringalpha", "marcelosousa"]'
      dba: '["joinreviewpad", "engineeringgamma"]'
      devops: '["reviewpad-bot", "engineeringalpha"]'
      developers: '["reviewpad-bot", "engineeringalpha", "engineeringbeta", "engineeringgamma", "joinreviewpad"]'
      humans: '["adrianoapmartins", "fmallet", "ferreiratiago", "zolamk", "shay2025", "FabioFreitasP", "catarinamarcal"]'

  - name: seniors-per-team
    spec:
      security: '["marcelosousa", "engineeringalpha"]'
      dba: '["joinreviewpad"]'
      devops: '["reviewpad-bot"]'
      developers: '["reviewpad-bot"]'
      humans: '["marcelosousa", "ferreiratiago"]'

workflows:
  - name: Assign senior reviewers
    run:
      - forEach:
          key: $teamName
          value: $teamMembers
          in: $dictionary("teams")
          do:
            - if: $isElementOf($author(), $teamMembers)
              then: 
                forEach:
                  key: $teamNameInner
                  value: $seniorMembers
                  in: $dictionary("seniors-per-team")
                  do:
                    if: $teamName == $teamNameInner
                    then: $assignReviewer($seniorMembers)

  - name: Block merge on labelling
    run:
      - if: $isElementOf("do-not-merge", $labels())
        then: $failCheckStatus("Do not merge")
